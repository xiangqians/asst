<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Editor</title>
    <!-- css -->
    <link rel="stylesheet" href="../static/lib/editor-0.1.0/editor.css">
    <style type="text/css">
        body {
            padding: 0;
            margin: 0;
            background-color: #f9f9f7;
        }

        .editor-wrapper {
            max-width: 800px;
            padding: 0px;
            margin: 0px auto;
        }
    </style>
</head>
<body>
<div class="editor-wrapper">
    <textarea id="editor" placeholder="Content here ...." style="display: none;"></textarea>
</div>
</body>
</html>

<!-- editor js -->
<script src="../static/lib/editor-0.1.0/editor.js"></script>
<script src="../static/lib/editor-0.1.0/marked.js"></script>
<script src="../static/lib/zepto-v1.2.0/zepto.min.js"></script>

<!-- md5 js -->
<script src='../static/js/utils.js'></script>

<!-- custom -->
<script src='../static/lib/md5-2.16.0/main.min.js'></script>

<!-- https://github.com/lepture/editor -->
<script>


    let requestParams = Utils.getRequestParams();
    console.log('requestParams', requestParams);

    function EditorHelper() {
        // Having done this, an editor instance can be created:
        // this.editor = new Editor();
        // this.editor.render();
        // The editor will take the position of the first <textarea> element.

        //
        this.editor = new Editor({
            element: document.getElementById('editor'),
            // toolbar: []
        });
        this.editor.render();
    }

    EditorHelper.prototype.refresh = function () {
        this.editor.codemirror.refresh();
    }

    EditorHelper.prototype.getValue = function () {
        // Get the content
        // To get back the edited content you use:
        return this.editor.codemirror.getValue();
    }

    EditorHelper.prototype.setValue = function (value) {
        this.editor.codemirror.setValue(value);
    }
    EditorHelper.prototype.save = function () {
        this.editor.codemirror.save();
    }

    window.editorHelper = new EditorHelper();

    window.onbeforeunload = function (event) {
        console.log(event);
    }

    // 定时检测内容是否发生变化，若发生变化便同步到服务器
    function check() {
        let hash = md5(window.editorHelper.getValue());
        console.log('hash', hash);
        window.setTimeout(check, 500);
    }

    window.setTimeout(check, 500); // ms

</script>

